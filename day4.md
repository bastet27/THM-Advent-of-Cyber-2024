# üéÑ TryHackMe Advent of Cyber 2024 ‚Äì Day 4: Atomic Red Team

## Challenge Overview üéÖ

Day 4 takes us into the world of **threat simulation** using the **Atomic Red Team framework**. In this challenge, we play both blue and red team roles. As the blue team, we analyze artifacts and logs from emulated attacks. As the red team, we execute simulated attacks to better understand detection gaps and potential mitigations. This challenge reinforces how adversary emulation aids in building robust detection mechanisms.

## Objectives üéØ

1. Identify artifacts created by a simulated spear-phishing attack.
2. Explore MITRE ATT&CK techniques and sub-techniques.
3. Simulate a ransomware attack and analyze the artifacts generated.
4. Craft a detection rule based on findings to improve defensive capabilities.

## Step 1: Spear-Phishing Simulation

### Running the Test
1. **Run the Atomic Test:**  
   Use the following command in PowerShell:  
   ```
   Invoke-AtomicTest T1566.001 -TestNumbers 1
   ```

2. **Locate the Output:**  
   Navigate to the directory `C:\Users\Administrator\AppData\Local\Temp\` and open the text file generated by the test.

### Answer:
- **Flag:** `THM{GlitchTestingForSpearphishing}`

## Step 2: Exploring MITRE ATT&CK Techniques

### Identifying the Technique and Sub-Technique
1. **Search for the Technique ID:**  
   The relevant MITRE ATT&CK technique for "command and scripting interpreter" is:
   - **Answer:** `T1059`

2. **Search for the Sub-Technique ID:**  
   The sub-technique ID for "Windows Command Shell" is:
   - **Answer:** `T1059.003`

## Step 3: Simulating a Ransomware Attack

### Running the Test
1. **Display Details of the Test:**  
   Use the following command to show details about the ransomware simulation:
   ```
   Invoke-AtomicTest T1059.003 -ShowDetails
   ```

2. **Name of the Test:**  
   The test is called:  
   - **Answer:** `Simulate BlackByte Ransomware Print Bombing`

3. **Name of the File Used:**  
   From the test details, the file generated is:  
   - **Answer:** `Wareville_Ransomware.txt`

4. **Retrieve the Flag:**  
   Run the test using the following command:
   ```
   Invoke-AtomicTest T1059.003 -TestNumbers 4
   ```
   Review the output artifacts, and you'll find the flag.

### Answer:
- **Flag:** `THM{R2xpdGNoIGlzIG5vdCB0aGUgZW5lbXk=}`

## Lessons Learned üåü

### MITRE ATT&CK Framework
- The MITRE ATT&CK framework organizes techniques and tactics used by real-world adversaries, providing defenders with a structured way to map attack vectors and detection methods.

### Atomic Red Team
- The Atomic Red Team framework is a powerful tool for testing detection gaps. It provides simple and reproducible test cases that mimic adversarial behavior.

### Detection Gaps
- No detection system is perfect. Regular testing helps identify gaps, allowing teams to create targeted detection rules.
- Blue teams must ensure that gaps at one phase of the kill chain are compensated for in subsequent phases.

### Creating Detection Rules
- Detection rules can be crafted from artifacts generated during simulations. For instance:
  - Look for suspicious PowerShell commands, like `Invoke-WebRequest`.
  - Monitor for specific files created during attack simulations.

## Tools Used üõ†Ô∏è

1. **Atomic Red Team:** Conducted emulated attacks mapped to MITRE ATT&CK techniques.
2. **Sysmon:** Monitored process creation, network connections, and file changes during simulations.
3. **Windows Event Viewer:** Analyzed logs generated during simulated attacks.

## Final Thoughts üéÅ

This challenge highlighted the importance of emulating real-world attack scenarios to strengthen defenses. By leveraging frameworks like MITRE ATT&CK and Atomic Red Team, organizations can proactively identify gaps in their detection capabilities and craft rules to mitigate future threats. Understanding attacker techniques is essential for building robust detection and prevention strategies.

## Questions and Answers

1. **What was the flag found in the .txt file that is found in the same directory as the PhishingAttachment.xslm artifact?**  
   **Answer:** `THM{GlitchTestingForSpearphishing}`

2. **What ATT&CK technique ID would be our point of interest?**  
   **Answer:** `T1059`

3. **What ATT&CK sub-technique ID focuses on the Windows Command Shell?**  
   **Answer:** `T1059.003`

4. **What is the name of the Atomic Test to be simulated?**  
   **Answer:** `Simulate BlackByte Ransomware Print Bombing`

5. **What is the name of the file used in the test?**  
   **Answer:** `Wareville_Ransomware.txt`

6. **What is the flag found from this Atomic Test?**  
   **Answer:** `THM{R2xpdGNoIGlzIG5vdCB0aGUgZW5lbXk=}`
   
## Table of Contents

- [Main Page](README.md)  
- [Day 1: OPSEC Challenge](day1.md)  
- [Day 2: Log Analysis](day2.md)  
- [Day 3: Log Analysis](day3.md)
- [Day 5: XXE](day5.md)
- [Day 6: Sandboxes](day6.md)
- [Day 7: AWS Sandboxes](day7.md)
- [More Days to Come!](#)
